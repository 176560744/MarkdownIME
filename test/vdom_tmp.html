<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>domchaos_tmp test</title>
  <style>
	  body {
	  }
	  .orig {
		  background: #ff0;
	  }
	  pre > *:nth-child(2n+1) {
		  background: #ddd;
	  }
  </style>
</head>
<body>
<script src="../dest/MarkdownIME.js"></script>
<h3>ORIG - The yellow elements are reused by DomChaos</h3>
<div id="cc">~~test\~~!~~<b>lorem<i>!ipsue</i></b>~~<br>!<br>~~<b>s</b> <b>s</b> <b>s</b> a<img src="2.jpg" alt="test">ha<b>ha</b>~~</div>
<hr>
<h3>COMPARE - a backup of the original data.</h3>
<div id="compare"></div>
<hr>
<h3>UNRENDER - shall be the same as the original data</h3>
<div id="cc2"></div>
<hr>
<h3>CONSOLE OUTPUT</h3>
<pre id="console"></pre>
<script>

	(function(){
		var oldLog = console.log;
		var output = document.getElementById('console');
		console.log = function (message) {
			// DO MESSAGE HERE.
			var ts=[];
			[].forEach.call(arguments,(vv)=>{
				ts.push(vv+"");
			})
			var t = document.createElement('div');
			t.textContent = ts.join(", ");
			output.appendChild(t);
			oldLog.apply(console, arguments);
		};
	})();
	
	var div = document.getElementById('cc');
	var div2 = document.getElementById('cc2');
	
	var origChild = [].slice.call(div.childNodes, 0);
	
	var cmp = document.getElementById('compare');
	cmp.innerHTML = div.innerHTML;
	
	var rule = new MarkdownIME.Renderer.InlineWrapperRule("del","~~","~~");
	
	var vdom = new MarkdownIME.DomChaos();
	
	vdom.cloneNode(div)
	rule.render(vdom)
	vdom.applyTo(div)
	
	rule.unrender(vdom)
	vdom.applyTo(div2)
	
	origChild.forEach((child)=>{
		if (child.parentNode && child.nodeType == 3) {
			var nc = document.createElement('span');
			nc.textContent = child.textContent;
			child.parentNode.replaceChild(nc, child);
			child = nc;
		}
		child.className = "orig";
	})
</script>
</body>
</html>